# Прогнозирование температуры сплава

### Описание проекта

Чтобы оптимизировать производственные расходы, металлургический комбинат «Стальная птица» решил уменьшить потребление электроэнергии на этапе обработки стали. Для этого комбинату нужно контролировать температуру сплава. 

Задача — построить модель, которая будет её предсказывать. Заказчик хочет использовать разработанную модель для имитации технологического процесса.

Описание этапа обработки
- Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн. Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом. Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша.
- Из сплава выводится сера (этот процесс — десульфурация), добавлением примесей корректируется химический состав и отбираются пробы. Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (от англ. tribe — «масса»).
- Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ. Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом. Затем его перемешивают и снова проводят измерения. Такой цикл повторяется до достижения целевого химического состава и оптимальной температуры плавки.
- Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки. Оттуда готовый продукт выходит в виде заготовок-слябов (от англ. slab — «плита»)

## Навыки и инструменты

- **python**
- **pandas**
- **numpy**
- **matplotlib**
- **seaborn**
- **phik**
- sklearn.model_selection.**train_test_split**
- sklearn.model_selection.**RandomizedSearchCV**
- sklearn.pipeline.**Pipeline**
- sklearn.preprocessing.**StandardScaler**
- sklearn.preprocessing.**MinMaxScaler**
- sklearn.compose.**ColumnTransformer**
- sklearn.inspection.**permutation_importance**
- sklearn.metrics.**mean_absolute_error**
- sklearn.metrics.**r2_score**
- sklearn.dummy.**DummyRegressor**
- sklearn.tree.**DecisionTreeRegressor**
- catboost.**CatBoostRegressor**
- xgboost.**XGBRegressor**

## 

## Общий вывод

1 Загрузка и 2 Исследовательский анализ данных
Были загружены семь датасетов, с последующим анализом и предобработкой. Внесены изменения в названия столбцов, типы данных изменены на верные (datetime).

В первом датасете с данными об электродах не обнаружены пропуски, активная мощность имеет нормальное распределение со скошенностью вправо, присутствуют выбросы на диапазоне больших значений. На графике реактивной мощности обнаружен и удален выброс с отрицательным значением.

В остальных таблицах было принято решение об удалении признаков с более чем 80% пропусков. В оставшихся случаях пропуски мы заменили на нули для последующего анализа.

Для датасетов с информацией о материалах и проволоке были построены гистограммы распределения - многие не имеют нормальное распределение. wire_1 и wire_2 имеют примерно похожее на нормальное распределение. Можно обсуловить тем, что не все материалы и проволоки добавляются в ковш.

В датасете с данными о продувке газом пропусков нет, распределение данных нормальное, со скошенностью вправо.

В ходе агрегации датасетов были созданы новые признаки: полная мощность, число итераций нагрева и работа, а также время подачи материала и проволоки.

По данным от заказчика, минимальная температура равна 1500, поэтому в датасете с данными о температуре были удалены все значения партий с температурой меньше 1500. Также были устранены данные с одним замером температуры, так как тут отсутствует таргет. Для последующего анализа были выделены первая и последняя температуры, время замера и количество измерений.

3 Объединение датасетов
Объединили все датасеты в общий по ключу key, в датасет попали только данные тех партий, которые представлены во всех таблицах. Удалили признаки key, время подачи материалов и проволоки, заполнили пропуски нулями. Получили датасет с 20 признаками

4 Исследовательский анализ общего датасета
Отметили в общем датасете характерные выбросы в данных о температуре, мощности и работе. Диаграммы распределения сыпучих материалов и проволоки имеют такое же неравномерное распределение по датасету. Данные о температуре первого и последнего замеров распределены нормально, с небольшим количеством выбросов.

Далее был проведен корреляционный анализ признаков. Признаки реактивная и активная мощность имеют высокую корреляцию с признаком полная мощность, количество измерений и число итераций нагрева - мультиколлинеарны. Также сильную корреляцию имеют признаки: количество измерений и мощность, работа и время нагрева.

В равной степени корреляция таргета с полной и активной мощностями, добавкой wire_1, а также с температурой первого замера и временем между измерениями.

Было принято решение удалить признаки с реактивной и активной мощностями и количеством измерений.

5 Подготовка данных
Далее разделили данные на тренировочную и тестовую выборки, получили 1743 и 581 строки соответственно.

6 Обучение моделей
Использовали пайплайн для обучения моделей, для перебора гиперпараметров использовали RandomizedSearchCV

7 Выбор лучшей модели
Лучшей моделью является CatBoostRegressor, с показателем MAE = 6.03. На втором и третьем месте - XGBRegressor, c показателем MAE = 6.16 и 6.21. CatBoostRegressor также показывает отличную скорость обучения, по сравнению с XGBRegressor

Параметры лучшей модели: {'models__learning_rate': 0.1, 'models__iterations': 150, 'models__depth': 5, 'models': <catboost.core.CatBoostRegressor at 0x7fb36714c640>} random_state=70425

На тестовой выборке лучшая модель показала результат метрики MAE = 6.05. Также рассчитали метрику R2, с результатом 0.45 - достаточно неплохой результат для модели. То есть модель неплохо понимает данные и сможет показать хорошие метрики на неизвестных данных.

Сравнили константную модель с лучшей - константная модель в среднем ошибается на 7.95 значений температуры, лучшая же модель CatBoostRegressor ошибается на 6.05.

Далее произвели анализ важности признаков. Наибольшую важность для модели представляют признаки: температура первого замера, время нагрева и время между измерениями - это имеет смысл, так как это все показатели процесса нагревания, важные для показателя конечной температуры. Небольшую роль играют признаки с объемом сыпучих материалов и проволоки. Наименее важными модель расценила признаки времени подачи материалов, полную мощность и число итераций нагрева - то есть на конечную температуру влияет то, какие материалы добавляют в ковш, но не время подачи.

Для улучшения качества предсказаний модели можно порекомендовать применить отбор признаков, например, с помощью метода перестановки permutation importance - чтобы вычислить, какие признаки на самом деле важны для модели, а какие она использует для подстройки и переобучения.

Также можно сгенерировать большее количество признаков, попробовать подбор большего количества гиперпараметров.
